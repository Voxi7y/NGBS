<!DOCTYPE html>
<html>
<head>
  <title>Bible Study App</title>
  <!-- Include Supabase JavaScript library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* === Basic Styling === */
    body {
      font-family: Arial, sans-serif;
      background: #f6f7fb;
      margin: 0;
      padding: 20px;
      transition: background 0.3s ease;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.05);
      animation: fadeIn 0.6s ease;
    }

    h1 { text-align: center; }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      border: none;
      background: #4a6cf7;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.1s ease;
    }

    button:hover { transform: scale(1.02); }

    .note {
      background: #f1f3ff;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      animation: slideUp 0.4s ease;
    }

    .hidden { display: none; }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>

<div class="container">

  <h1>ðŸ“– Bible Study</h1>

  <!-- === AUTHENTICATION SECTION === -->
  <div id="authSection">
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="signUp()">Sign Up</button>
    <button onclick="signIn()">Login</button>
  </div>

  <!-- === APP SECTION === -->
  <div id="appSection" class="hidden">
    <h2>Verse of the Day</h2>
    <div id="verse"></div>

    <h2>Add Note</h2>
    <input id="noteVerse" placeholder="Verse reference (e.g. John 3:16)">
    <textarea id="noteContent" placeholder="Your study notes..."></textarea>
    <button onclick="addNote()">Save Note</button>

    <h2>Your Notes</h2>
    <div id="notes"></div>

    <button onclick="logout()">Logout</button>
  </div>

</div>

<script>
  // =============================================
  // ========== SUPABASE SETUP ===================
  // =============================================
  
  // ðŸ”¹ STEP 1: Replace the text below with your Supabase Project URL
  const SUPABASE_URL = "https://zynoywhogvoupkstjits.supabase.co";   // ### PUT YOUR SUPABASE PROJECT URL HERE ###

  // ðŸ”¹ STEP 2: Replace the text below with your Supabase ANON PUBLIC KEY
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5bm95d2hvZ3ZvdXBrc3RqaXRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIyODYwNzksImV4cCI6MjA4Nzg2MjA3OX0.lzy80E-oLeKH2FQDiyFOm8w9ypMtjUaU4QzUG8k_wTw";   // ### PUT YOUR SUPABASE ANON PUBLIC KEY HERE ###

  // Create Supabase client
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // === GET HTML ELEMENTS ===
  const authSection = document.getElementById("authSection");
  const appSection = document.getElementById("appSection");

  // === CHECK IF USER IS LOGGED IN ===
  checkUser();

  async function checkUser() {
    const { data } = await supabaseClient.auth.getSession();
    if (data.session) {
      showApp();
    }
  }

  // === SHOW APP SECTION ===
  function showApp() {
    authSection.classList.add("hidden");
    appSection.classList.remove("hidden");
    loadVerse();
    fetchNotes();
  }

  // === SIGN UP FUNCTION ===
  async function signUp() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    await supabaseClient.auth.signUp({ email, password });
    alert("Check your email to confirm your account!");
  }

  // === SIGN IN FUNCTION ===
  async function signIn() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
    if (!error) showApp();
    else alert("Login failed! Check email/password.");
  }

  // === LOGOUT FUNCTION ===
  async function logout() {
    await supabaseClient.auth.signOut();
    location.reload();
  }

  // === LOAD VERSE OF THE DAY ===
  async function loadVerse() {
    const response = await fetch("https://bible-api.com/john 3:16");  // Public Bible API
    const data = await response.json();
    document.getElementById("verse").innerHTML =
      `<strong>${data.reference}</strong><p>${data.text}</p>`;
  }

  // === ADD NOTE FUNCTION ===
  async function addNote() {
    const verse = document.getElementById("noteVerse").value;
    const content = document.getElementById("noteContent").value;

    const { data: userData } = await supabaseClient.auth.getUser();

    await supabaseClient.from("notes").insert([
      {
        user_id: userData.user.id,
        verse: verse,
        content: content
      }
    ]);

    // Clear inputs
    document.getElementById("noteVerse").value = "";
    document.getElementById("noteContent").value = "";

    fetchNotes();
  }

  // === FETCH NOTES FUNCTION ===
  async function fetchNotes() {
    const { data: userData } = await supabaseClient.auth.getUser();

    const { data } = await supabaseClient
      .from("notes")
      .select("*")
      .eq("user_id", userData.user.id)
      .order("id", { ascending: false });

    const notesDiv = document.getElementById("notes");
    notesDiv.innerHTML = "";

    data.forEach(note => {
      notesDiv.innerHTML += `
        <div class="note">
          <strong>${note.verse}</strong>
          <p>${note.content}</p>
        </div>
      `;
    });
  }

</script>

</body>
</html>
