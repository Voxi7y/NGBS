<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NGBS</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  body { font-family:'Segoe UI', Arial, sans-serif; margin:0; padding:0; background:#f2f4f8; }
  .container { max-width:800px; margin:auto; padding:20px; }
  h1,h2 { text-align:center; }
  .card { background:white; border-radius:12px; padding:20px; margin-bottom:20px; box-shadow:0 6px 18px rgba(0,0,0,0.08); }
  button { padding:10px 20px; border:none; border-radius:8px; background:#4a6cf7; color:white; cursor:pointer; margin-top:10px; transition:all 0.2s ease; }
  button:hover { transform:scale(1.05); }
  input, textarea { width:100%; padding:10px; margin-top:8px; border-radius:6px; border:1px solid #ccc; }
  .note { background:#f1f3ff; padding:10px; border-radius:6px; margin-top:10px; }
  .hidden { display:none; }
  .search-result { background:#e9efff; padding:10px; margin-top:5px; border-radius:6px; cursor:pointer; }
  .search-result button { background:#6c63ff; margin-top:5px; }
  @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  .fadeIn { animation:fadeIn 0.5s ease; }
</style>
</head>
<body>

<div class="container">

  <h1>ðŸ“– NGBS</h1>

  <!-- ===== LOGIN SECTION ===== -->
  <div id="authSection" class="card fadeIn">
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="signUp()">Sign Up</button>
    <button onclick="signIn()">Login</button>
  </div>

  <!-- ===== APP SECTION ===== -->
  <div id="appSection" class="hidden">

    <!-- Verse of the Day -->
    <div class="card fadeIn">
      <h2>Verse of the Day</h2>
      <div id="verse"></div>
    </div>

    <!-- Search Bible -->
    <div class="card fadeIn">
      <h2>Search Bible</h2>
      <input id="searchInput" placeholder="e.g. John 3 or Psalm 23">
      <button onclick="searchVerse()">Search</button>
      <div id="searchResults"></div>
    </div>

    <!-- Your Notes -->
    <div class="card fadeIn">
      <h2>Your Notes</h2>
      <div id="notes"></div>
    </div>

  <button onclick="logout()">Logout</button>
  </div>

</div>

<script>
  // =====================================
  // ===== SUPABASE CONFIGURATION ========
  // =====================================
  const SUPABASE_URL = "https://zynoywhogvoupkstjits.supabase.co";   // ### <-- PUT YOUR SUPABASE PROJECT URL HERE ###
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5bm95d2hvZ3ZvdXBrc3RqaXRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIyODYwNzksImV4cCI6MjA4Nzg2MjA3OX0.lzy80E-oLeKH2FQDiyFOm8w9ypMtjUaU4QzUG8k_wTw";   // ### <-- PUT YOUR SUPABASE ANON PUBLIC KEY HERE ###

  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const authSection = document.getElementById("authSection");
  const appSection = document.getElementById("appSection");

  checkUser();

  // ===== AUTH FUNCTIONS =====
  async function checkUser() {
    const { data } = await supabaseClient.auth.getSession();
    if (data.session) showApp();
  }

  function showApp() {
    authSection.classList.add("hidden");
    appSection.classList.remove("hidden");
    loadVerse();
    fetchNotes();
  }

  async function signUp() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    await supabaseClient.auth.signUp({ email, password });
    alert("Check your email to confirm your account!");
  }

  async function signIn() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
    if (!error) showApp();
    else alert("Login failed! Check email/password.");
  }

  async function logout() {
    await supabaseClient.auth.signOut();
    location.reload();
  }

  // ===== VERSE OF THE DAY =====
  async function loadVerse() {
    const response = await fetch("https://bible-api.com/john 3:16");
    const data = await response.json();
    document.getElementById("verse").innerHTML = `<strong>${data.reference}</strong><p>${data.text}</p>`;
  }

  // ===== SEARCH FUNCTION (CHAPTERS & VERSES) =====
  async function searchVerse() {
    const query = document.getElementById("searchInput").value;
    if(!query) return alert("Enter a verse or chapter to search!");
    const response = await fetch(`https://bible-api.com/${encodeURIComponent(query)}`);
    const data = await response.json();
    const resultsDiv = document.getElementById("searchResults");
    resultsDiv.innerHTML = ""; // Clear previous results

    // Check if API returns multiple verses (chapter)
    if(data.verses && data.verses.length > 0){
      data.verses.forEach(v => {
        const div = document.createElement("div");
        div.classList.add("search-result");
        div.innerHTML = `<strong>${v.reference}</strong><p>${v.text}</p>`;
        const btn = document.createElement("button");
        btn.innerText = "Add Note";
        btn.onclick = () => addNoteFromSearch(v.reference);
        div.appendChild(btn);
        resultsDiv.appendChild(div);
      });
    } else {
      // Single verse result
      const div = document.createElement("div");
      div.classList.add("search-result");
      div.innerHTML = `<strong>${data.reference}</strong><p>${data.text}</p>`;
      const btn = document.createElement("button");
      btn.innerText = "Add Note";
      btn.onclick = () => addNoteFromSearch(data.reference);
      div.appendChild(btn);
      resultsDiv.appendChild(div);
    }
  }

  // ===== ADD NOTE FROM SEARCH =====
  async function addNoteFromSearch(verse) {
    const content = prompt(`Add your note for ${verse}:`);
    if(!content) return;
    const { data: userData } = await supabaseClient.auth.getUser();
    await supabaseClient.from("notes").insert([{ user_id: userData.user.id, verse, content }]);
    fetchNotes(); // Refresh notes on homepage
  }

  // ===== FETCH NOTES =====
  async function fetchNotes() {
    const { data: userData } = await supabaseClient.auth.getUser();
    const { data } = await supabaseClient.from("notes").select("*").eq("user_id", userData.user.id).order("id",{ascending:false});
    const notesDiv = document.getElementById("notes");
    notesDiv.innerHTML = "";
    data.forEach(note => {
      notesDiv.innerHTML += `<div class="note"><strong>${note.verse}</strong><p>${note.content}</p></div>`;
    });
  }

</script>
</body>
</html>
